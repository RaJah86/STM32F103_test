
#include <stdint.h>
#include "stm32f10x.h"

#include "SYS_Clock.h"
#include "I2C.h"
#include "OLED_Mono_128x64.h"

////////////////////////////////////////////////////////////////////////

uint8_t BarashBuff [] =
{
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x01, 0xFF, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xFE, 0x10, 0x00, 0x00,
0x00, 0x00, 0x00, 0x0F, 0xFE, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0x80, 0x00, 0x00,
0x00, 0x00, 0x00, 0x3F, 0xFF, 0xC4, 0x00, 0x00, 0x00, 0x00, 0x01, 0x83, 0x01, 0xF4, 0x00, 0x00,
0x00, 0x00, 0x06, 0x00, 0x40, 0xC4, 0x00, 0x00, 0x00, 0x01, 0x8D, 0x81, 0xD8, 0x34, 0x00, 0x00,
0x00, 0x1F, 0xF9, 0x01, 0x20, 0x46, 0x00, 0x00, 0x00, 0x3F, 0xF9, 0x00, 0x00, 0x00, 0x80, 0x00,
0x00, 0x7F, 0xF9, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0xFC, 0xF0, 0x10, 0x38, 0x00, 0x20, 0x00,
0x01, 0xF0, 0x00, 0x01, 0x3C, 0x00, 0x10, 0x00, 0x03, 0xE0, 0x00, 0x00, 0xBC, 0x00, 0x10, 0x00,
0x03, 0xC3, 0x80, 0x40, 0x78, 0x00, 0x00, 0x00, 0x03, 0xC7, 0xC0, 0x80, 0x30, 0x00, 0x08, 0x00,
0x03, 0xC4, 0xC0, 0x00, 0x18, 0x00, 0x08, 0x00, 0x03, 0xC0, 0xC3, 0x80, 0x10, 0x00, 0x04, 0x00,
0x03, 0xE0, 0xC3, 0xC0, 0x00, 0x00, 0x01, 0x00, 0x07, 0xFB, 0x83, 0xC0, 0x00, 0x00, 0x01, 0x00,
0x0F, 0xFF, 0x03, 0xC0, 0x00, 0x20, 0x00, 0x80, 0x0B, 0xFE, 0x00, 0x00, 0x00, 0xE0, 0x00, 0x80,
0x01, 0x88, 0x01, 0x00, 0x03, 0xC0, 0x00, 0x00, 0x11, 0x90, 0x00, 0x80, 0x2F, 0x80, 0x00, 0x00,
0x11, 0x10, 0x00, 0x40, 0x40, 0x40, 0x00, 0x00, 0x11, 0x10, 0x00, 0x1F, 0x00, 0x04, 0x00, 0x80,
0x11, 0x11, 0x00, 0x00, 0x00, 0x04, 0x00, 0x80, 0x11, 0x11, 0x00, 0x00, 0x04, 0x18, 0x00, 0x80,
0x11, 0x93, 0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00, 0x9E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
0x08, 0x48, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40,
0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00,
0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00,
0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
0x00, 0x18, 0x00, 0x00, 0x00, 0x01, 0xF0, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x06, 0x0C, 0x00,
0x00, 0x03, 0x80, 0x00, 0x00, 0x08, 0x03, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x00, 0x10, 0x01, 0xE0,
0x00, 0x00, 0x40, 0x00, 0x00, 0x20, 0x03, 0xF0, 0x00, 0x00, 0x20, 0x00, 0x00, 0x06, 0x33, 0xC0,
0x00, 0x00, 0x1D, 0x00, 0x00, 0x61, 0x0F, 0x80, 0x00, 0x00, 0x01, 0x80, 0xFF, 0x00, 0x87, 0x80,
0x00, 0x00, 0x00, 0x43, 0x00, 0x00, 0x44, 0x80, 0x00, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x42, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x19, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
SymbolType Barash = {64, 64, &BarashBuff[0]};	
	
////////////////////////////////////////////////////////////////////////

void SystemInit (void)
{
	uint32_t ret = 0;
	ret = INIT_SYS_Clock();		//__Настройка системы тактирования.
	if(100 < ret)
	{
		while(1);
	}

	////////////////////////////////////////////////////
	
	I2C_HeaderInit();			//__Инициализация I2C.
		
	////////////////////////////////////////////////////
/*	
	RCC->APB2ENR |= RCC_APB2ENR_IOPCEN;				//__Разрешить тактирование порта С.
	GPIOC->CRH |= GPIO_CRH_MODE13;						//__C13 как выход (50MHz).
	GPIOC->CRH &= ~GPIO_CRH_CNF13_0;					//
*/	
/*	
	GPIOC->CRL |= GPIO_CRL_MODE1;							//__C1 как выход (50MHz).
	GPIOC->CRL &= ~GPIO_CRL_CNF1_0;						//
*/
	////////////////////////////////////////////////////
	
	RCC->APB2ENR |= RCC_APB2ENR_IOPCEN;		//__Разрешить тактирование порта С.
	
	GPIOC->CRL &= ~GPIO_CRL_CNF1_0;				//__С1 - вход с подтяжкой. 	
	GPIOC->CRL |=  GPIO_CRL_CNF1_1;				//	 
	GPIOC->CRL &= ~GPIO_CRL_MODE1;				//	
	GPIOC->ODR |= GPIO_ODR_ODR1;					//__Подтяжка к 1.
	
	GPIOC->CRH &= ~GPIO_CRH_CNF13_0;			//__С13 - вход с подтяжкой. 	
	GPIOC->CRH |=  GPIO_CRH_CNF13_1;			//	 
	GPIOC->CRH &= ~GPIO_CRH_MODE13;				//	
	GPIOC->ODR |= GPIO_ODR_ODR13;					//__Подтяжка к 1.	
	
	/////////////////////////////////////////////////////	
		
}

///////////////////////////////////////////////////////////////////////////////



int main (void)
{	
	uint32_t i, i2, i3 = 0;
	uint8_t i4 = 0;
	uint8_t X, Y;		
	OLED_Init(0x78);			//__Инициализация OLED.
	I2C2_Struct = &OLED;	//__Настройка I2C на работу с OLED.
	
	I2C_IntEvEn();				//__Разрешить прерывания I2C.
	
	
	__enable_fiq();	//__Глобальное разрешение прерываний.
			

	
	while(1)	
	{	
		OLED_SendSym(0, 0, &Barash, 0);

		for(i2 = 0; i2 < 15; i2++)
		{
			while(d_I2C_WaitBusy);
			if(i2)
			{
				X = (5 * (i2 - 1));
				Y = (3 * (i3 - 1));
			}
			//OLED_ClearXY(X, Y, 24, 20);
			X = (5 * i2);
			Y = (3 * i3);			
			//OLED_SendSym(X, Y, &Medusa, 0);
			//OLED_SendSym((X + Medusa.Width), Y, &Medusa, 1);	
			i3++;
			d_I2C_Start();		//__Старт.	
			for(i = 0; i < 399990; i++);		//__Тупо задержка времени.
		}
	}
}

////////////////////////////////////////////////////////////////////////






